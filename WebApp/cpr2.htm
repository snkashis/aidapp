<html>

<head>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="user-scalable=no, width=device-width" />
    <link rel="stylesheet" type="text/css" href="style.css">

<script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
<title>CPR 2</title>


<script>
$(document).ready(function(){
    
var CompressionsDone = false;
var TiltDone = false;
var NoseDone = false;
var BreathsDone = false;

var Compressions = 0;
var Tilt = 0;
var Nose = 0;
var Breaths = 0;


$('#right_nav_button').bind('click', function() {
    var CheckOpacity = $('#right_nav_button').css('opacity');
    if (CheckOpacity==1){
    
    $.ajax({
			url: "set_responses.php",
			data: "cpr_compressions="+ Compressions + "&cpr_chin="+ Tilt + "&cpr_nose=" + Nose + "&cpr_breaths=" + Breaths,
			success: function(data){
                        alert(data);
                        //Maybe gray out box and change the area to a "success" message
			}
                });
    setTimeout(function() {
	window.location = 'tutorial_results.htm';
    },500);
    }
});
   

//trying to remove the ability to click checkboxs
$(':checkbox').bind('click', function() {
    this.blur();
  event.preventDefault();
    });


$('#comp_button').bind('click', function(){
compression_Count++;
$('#count_area').text(compression_Count);
}
);

$('#breath_button').bind('click', function(){
Breath_Count++;
$('#breath_count_area').text(Breath_Count);
}
);

document.getElementById('vid_cpr').load();
document.getElementById('vid_cpr').play();

var compression_Count = 0;
var last_Comp_Value = '0';

var Breath_Count = 0;
var last_Breath_Value = '0';

var get_all = setInterval(function() {

    
    $.getJSON('get_all_states.php', function(data) {
    
    var Comp_Check = $('#compressions_CheckBox:checked').val();
    var Chin_Check = $('#chin_CheckBox:checked').val();
    var Nose_Check = $('#nose_CheckBox:checked').val();
    var Breath_Check = $('#breaths_CheckBox:checked').val();
    
    
    if (compression_Count >= 30) {
    $('#compressions_CheckBox').attr('checked', 'checked');
    Compressions=1;
    }
    else {
    if (data.force1 != last_Comp_Value) {
    compression_Count++;
    $('#count_area').text(compression_Count);
    //alert(compression_Count);
    last_Comp_Value = str(data.force1);
    }
    }
    
    if (Breath_Count >= 2) {
    $('#breaths_CheckBox').attr('checked', 'checked');
    $('#right_nav_button').fadeTo('slow', 1);
    Breaths=1;
    }
    else {
    if (data.temp != last_Breath_Value) {
    Breath_Count++;
    $('#breath_count_area').text(Breath_Count);
    //alert(compression_Count);
    last_Breath_Value = str(data.temp);
    }
    }
    
    
    
    
    
	//alert(Chin_is_Checked);
	 if (Chin_Check == 'on' && Comp_Check == undefined)
	{
	    	    $('#compressions_CheckBox').replaceWith('<span style="color:red;"><b>X</b></span> ');
	}
        
        if (Nose_Check == 'on' && Chin_Check == undefined)
	{
	    	    $('#chin_CheckBox').replaceWith('<span style="color:red;"><b>X</b></span> ');
	}
        
    
    if (data.tilt == '1') {
    
	if (Chin_Check == undefined) {
	    	    $('#chin_CheckBox').attr('checked', 'checked');
                    Tilt=1;
	}
    }

    if (data.force2 == '1') {
        
        if (Nose_Check == undefined) {
            $('#nose_CheckBox').attr('checked', 'checked');
            Nose=1;
        }
    }
    
    
	})
}, 1250);



});
</script>


</head>

<body>
    <div id="main">
        <p>Now it's YOUR turn, <b>practice</b> on the doll the steps you have previously learned.</p>
        <div id="left">
<video class="videocss" src="videos/cpr2.mp4" loop width=450 height=368 id="vid_cpr">
        </div>
    <div id="right" style="position:absolute;right:10px;top:50px;">

<br/>

<br/>
<form>
<input type="checkbox" class="action_checkbox" id="compressions_CheckBox">Compressions (30X)<br/>
<input type="checkbox" class="action_checkbox" id="chin_CheckBox">Lift Chin<br/>
<input type="checkbox" class="action_checkbox" id="nose_CheckBox">Pinch Nose<br/>
<input type="checkbox" class="action_checkbox" id="breaths_CheckBox">Rescue Breaths (2X)

</form>

<p id="comp_button">Comp COUNT:</p><br/>
<p id="count_area"></p>
<br/>

<p id="breath_button">Breath COUNT:</p><br/>
<p id="breath_count_area"></p>
<br/>

    </div>
    
<a href="cpr1.htm" id="left_nav_button">Previous</a>  <a id="right_nav_button" style="opacity: 0.4;">Done</a>
    </div>
    </div>
</body>
</html>